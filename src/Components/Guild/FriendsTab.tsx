// SolidJS
import { onCleanup, onMount } from 'solid-js';

// API
import { useAppState } from '../../AppState';

// Style
import { t } from '../../Translation';
import style from './css.module.css';
const FriendsTab = () => {
	const AppState = useAppState();

	let toolTipRef: HTMLElement;
	let ref: HTMLLIElement;

	function updateRelativeYPositon() {
		console.log('updating relative position');
		const boundingRect = ref.getBoundingClientRect();
		toolTipRef.style.top = `${boundingRect.top + window.scrollY + boundingRect.height / 2}px`;
	}
	onMount(() => {
		const boundingRect = ref.getBoundingClientRect();
		updateRelativeYPositon();
		toolTipRef.style.left = `${boundingRect.width}px`;

		ref.parentElement.parentElement.addEventListener('scroll', updateRelativeYPositon);
	});
	onCleanup(() => {
		ref.parentElement.parentElement.removeEventListener('scroll', updateRelativeYPositon);
	});

	//TODO: rewrite data storing to use arrays to remove constant find calls

	//TODO: move to seperate component

	return (
		<li class={style.guild} ref={ref}>
			<button
				onClick={() => {
					if (AppState.currentGuild() !== 'friends') {
						AppState.setCurrentGuild('friends');
					} else {
						AppState.setCurrentGuild(null);
					}
				}}
			>
				<h1 class={style.fallbackText}>
					<svg width="1240" height="1240" viewBox="0 0 128 100" fill="none" xmlns="http://www.w3.org/2000/svg">
						<path
							d="M46.7035 46.9397C46.7035 51.0842 44.3921 54.444 41.5409 54.444C38.6896 54.444 36.3783 51.0842 36.3783 46.9397C36.3783 42.7951 38.6896 39.4354 41.5409 39.4354C44.3921 39.4354 46.7035 42.7951 46.7035 46.9397Z"
							fill="#ED5413"
						/>
						<path
							d="M81.3726 46.658C81.3726 50.8026 83.684 54.1623 86.5352 54.1623C89.3864 54.1623 91.6978 50.8026 91.6978 46.658C91.6978 42.5135 89.3864 39.1537 86.5352 39.1537C83.684 39.1537 81.3726 42.5135 81.3726 46.658Z"
							fill="#ED5413"
						/>
						<path
							fill-rule="evenodd"
							clip-rule="evenodd"
							d="M64 7.23984C71.3876 7.23984 78.2206 8.32232 84.443 10.3296C92.4463 3.87091 110.063 -4.93919 127.535 3.41126C128.641 13.63 128.289 33.1351 120.651 44.3249C124.417 53.3206 126.4 59.8493 126.4 70.5883C121.546 76.4001 116.05 82.5044 111.2 86.4255C113.096 70.279 108.218 59.4869 94.2081 50.6568C94.4928 49.3253 94.6479 47.893 94.6479 46.3965C94.6479 39.1019 90.9637 33.3334 86.5349 33.3334C82.1062 33.3334 78.4225 39.1019 78.4225 46.3965C78.4225 53.6911 82.1064 59.4596 86.5352 59.4596C87.8188 59.4596 89.0395 58.975 90.1265 58.1092C97.3804 64.4309 105.679 82.2196 94.2322 96.4055C85.8288 99.7639 77.2684 99.9738 64 100C50.7316 99.9738 42.1712 99.7639 33.7678 96.4055C22.3214 82.2196 30.6196 64.4309 37.8735 58.1092C38.9605 58.975 40.1812 59.4596 41.4648 59.4596C45.8935 59.4596 49.5775 53.6911 49.5775 46.3965C49.5775 39.1019 45.8938 33.3334 41.4651 33.3334C37.0363 33.3334 33.3521 39.1019 33.3521 46.3965C33.3521 47.893 33.5072 49.3253 33.7919 50.6568C19.782 59.4869 14.9044 70.279 16.8 86.4255C11.9502 82.5044 6.45427 76.4001 1.6 70.5883C1.6 59.8493 3.58283 53.3206 7.34881 44.3249C-0.289428 33.1351 -0.641021 13.63 0.465424 3.41126C17.9365 -4.93919 35.5537 3.87091 43.5569 10.3296C49.7794 8.32232 56.6124 7.23984 64 7.23984ZM74.5028 29.4872C74.8005 30.9838 76.2324 32.0024 78.0251 32.5317C79.052 32.8348 80.1948 32.1951 81.4335 31.5017C82.3838 30.9698 83.3904 30.4063 84.4445 30.2125C85.5247 30.0139 86.5768 30.2178 87.5424 30.405C88.7474 30.6386 89.8176 30.8461 90.6396 30.2125C92.1031 29.0846 93.0427 27.6299 92.7449 26.1333C92.4472 24.6366 91.0154 23.618 89.2227 23.0888C87.4082 22.5533 85.0771 22.4639 82.6488 22.9103C80.2205 23.3567 78.0888 24.2667 76.6083 25.4081C75.145 26.536 74.2051 27.9905 74.5028 29.4872ZM94.1306 14.4459C99.5436 10.0456 107.739 5.77107 120 11.6269C120.841 19.389 120.752 27.6909 114.856 33.4597C109.588 25.5317 102.612 19.0047 94.1306 14.4459ZM68.588 80.8289C66.9613 80.2254 65.6295 77.9611 65 73.6812C68.045 72.7276 73.0529 66.6995 72 64.5992C70.8529 62.311 57.1471 62.7271 56 64.5992C54.9471 66.6995 59.9549 72.7276 63 73.6812C62.3705 77.9611 61.0387 80.2254 59.412 80.8289C57.8569 81.4058 55.8017 80.7529 53.8909 78.1943C53.5931 77.7955 53.0283 77.7136 52.6293 78.0112C52.2304 78.3088 52.1483 78.8732 52.4461 79.272C54.5903 82.1433 57.41 83.4936 60.0395 82.5181C61.8373 81.8511 63.0699 80.218 64 77.7177C64.9301 80.218 66.1627 81.8511 67.9605 82.5181C70.5899 83.4936 73.4097 82.1433 75.5539 79.272C75.8517 78.8732 75.7696 78.3088 75.3707 78.0112C74.9717 77.7136 74.4069 77.7955 74.1091 78.1943C72.1983 80.7529 70.1431 81.4058 68.588 80.8289ZM53.4972 29.4872C53.1995 30.9838 51.7676 32.0024 49.9749 32.5317C48.948 32.8348 47.8052 32.1951 46.5665 31.5017C45.6162 30.9698 44.6096 30.4063 43.5555 30.2125C42.4753 30.0139 41.4232 30.2178 40.4576 30.405C39.2526 30.6386 38.1823 30.8461 37.3604 30.2125C35.8969 29.0846 34.9573 27.6299 35.2551 26.1333C35.5528 24.6366 36.9846 23.618 38.7773 23.0888C40.5918 22.5533 42.9229 22.4639 45.3512 22.9103C47.7795 23.3567 49.9112 24.2667 51.3917 25.4081C52.855 26.536 53.7949 27.9905 53.4972 29.4872ZM33.8694 14.4459C28.4564 10.0456 20.2611 5.77107 8.00001 11.6269C7.15902 19.389 7.24804 27.6909 13.1435 33.4597C18.4123 25.5317 25.3881 19.0047 33.8694 14.4459Z"
							fill="#ED5413"
						/>
					</svg>
				</h1>
			</button>
			<aside ref={toolTipRef}>{t.friends()}</aside>
		</li>
	);
};
export default FriendsTab;
